var N=Object.defineProperty;var j=(t,e,i)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var n=(t,e,i)=>j(t,typeof e!="symbol"?e+"":e,i);import{d as P,c as u,u as o,q as W,o as c,F as m,P as S,n as A}from"./vue-BT0QQwX_.js";import{_ as O}from"./index-BSHGRBkn.js";import"./element-Dy8QUOXa.js";const R=(t,e,i,s)=>e||(typeof t=="number"?t*s/i:typeof t=="string"&&t.search("px")!==-1?Number(t.replace("px",""))*s/i:typeof t=="string"&&t==="100%"?"100%":360),I=!!(typeof window<"u"&&window.document&&window.document.createElement),F=["width","height","src"],q="//player.bilibili.com/player.html",f=P({__name:"core",props:{vid:{type:String,require:!0},autoplay:{type:Boolean,require:!1},page:{type:Number,require:!1},isWide:{type:Boolean,require:!1},highQuality:{type:Boolean,require:!1},hasDanmaku:{type:Boolean,require:!1},aspectWidth:{type:Number,require:!1},aspectHeight:{type:Number,require:!1},width:{type:String||Number,require:!1},height:{type:String||Number,require:!1},iframeClass:{type:String,require:!1}},setup(t){let e=t;const{vid:i,autoplay:s}=e,a=e.page||1,r=e.isWide||!0,l=e.highQuality||!0,p=e.hasDanmaku||!1,d=I?4:16,h=I?3:9,V=e.aspectWidth||d,B=e.aspectHeight||h,y=e.width||480,U=R(y,e.height,V,B),k=e.iframeClass||"",_=l?1:0,b=r?1:0,w=p?1:0;let v="",g="";i.toLocaleLowerCase().startsWith("bv")?g=i:v=i;const D=g?`${q}?bvid=${g}&page=${a}&high_quality=${_}&as_wide=${b}&danmaku=${w}&autoplay=${s?1:0}`:`${q}?aid=${v}&page=${a}&high_quality=${_}&as_wide=${b}&danmaku=${w}&autoplay=${s?1:0}`;return(K,X)=>(c(),u("iframe",{width:o(y),height:o(U),src:o(D),allowFullScreen:!0,class:W({iframeClassImp:o(k)})},null,10,F))}});f.install=t=>{t.component("bilibili-embed-renderer",f)};const $={hj:["BV1sn4y1f7Zq"]};class C{constructor({cid:e,bvid:i,name:s,singer:a,cover:r,musicSrc:l,singerId:p,lyric:d,lyricOffset:h}){n(this,"id","");n(this,"bvid","");n(this,"name","");n(this,"singer","");n(this,"singerId","");n(this,"cover","");n(this,"musicSrc","");n(this,"lyric","");n(this,"lyricOffset","");this.id=e,this.bvid=i,this.name=s,this.singer=a,this.singerId=p,this.cover=r,this.musicSrc=l,this.lyric=d,this.lyricOffset=h}}class H{constructor(e,i,s,a,r,l){n(this,"title","");n(this,"desc","");n(this,"videos",0);n(this,"picSrc","");n(this,"uploader","");n(this,"pages",[]);this.title=e,this.desc=i,this.videos=s,this.picSrc=a,this.uploader=r,this.pages=l}isMutiPartVideo(){return this.videos>1}getMultiPartVideoList(){}}const Q="https://api.bilibili.com/x/player/playurl?cid={cid}&bvid={bvid}&qn=64&fnval=16",E="https://api.bilibili.com/x/player/pagelist?bvid={bvid}&jsonp=jsonp",M="https://api.bilibili.com/x/web-interface/view?bvid={bvid}",x=async(t,e)=>(e||(e=await z(t).catch(i=>console.log(i))),new Promise((i,s)=>{window.chrome.storage.local.get(["CurrentPlaying","PlayerSetting"],function(a){a.CurrentPlaying&&a.CurrentPlaying.cid==e&&a.PlayerSetting.playMode!="singleLoop"?i(a.playUrl):fetch(Q.replace("{bvid}",t).replace("{cid}",e)).then(r=>r.json()).then(r=>i(L(r,"AudioUrl"))).catch(r=>s(console.log(r)))})})),z=async t=>{const i=await(await fetch(E.replace("{bvid}",t))).json();return L(i,"CID")},J=async t=>{console.info("calling fetchVideoInfo");const i=await(await fetch(M.replace("{bvid}",t))).json();try{const s=i.data;return new H(s.title,s.desc,s.videos,s.pic,s.owner,s.pages.map(r=>({bvid:t,part:r.part,cid:r.cid})))}catch{console.log("Some issue happened when fetching",t)}},L=(t,e)=>{if(e==="AudioUrl")return t.data.dash.audio[0].baseUrl;if(e==="CID")return t.data[0].cid;if(e=="AudioInfo")return{}},T=async t=>{const e=await J(t);let i="",s=[];if((e==null?void 0:e.pages.length)==1)return[new C({cid:e.pages[0].cid,bvid:t,name:e.title,singer:e.uploader.name,singerId:e.uploader.mid,cover:e.picSrc,musicSrc:()=>x(t,e.pages[0].cid),lyric:i})];if(e)for(let a=0;a<e.pages.length;a++){let r=e.pages[a];s.push(new C({cid:r.cid,bvid:t,name:r.part,singer:e.uploader.name,singerId:e.uploader.mid,cover:e.picSrc,musicSrc:()=>x(t,r.cid),lyric:i}))}return s},Y={class:"aspect-ratio"},Z=P({__name:"index",setup(t){return T($.hj[0]),(e,i)=>(c(),u("div",Y,[(c(!0),u(m,null,S(o($),(s,a)=>(c(),u(m,null,[(c(!0),u(m,null,S(s,r=>(c(),A(o(f),{vid:r},null,8,["vid"]))),256))],64))),256))]))}}),re=O(Z,[["__scopeId","data-v-790c43a4"]]);export{re as default};
